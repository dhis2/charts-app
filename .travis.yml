language: node_js
node_js:
- '6'
cache:
  directories:
  - node_modules

before_script:
- cd $HOME
- git clone --depth=10 -b v25 https://github.com/dhis2/d2-charts-api.git
- cd $HOME/d2-charts-api
- npm install
- npm run build

script:
- npm link d2-charts-api
- npm run build
after_success:
- if ( [ "$TRAVIS_BRANCH" == "master" ] || [ ! -z "$TRAVIS_TAG" ] ) && [ "$TRAVIS_REPO_SLUG" == "dhis2/charts-app" ]  &&  [ "$TRAVIS_PULL_REQUEST" == "false" ] ;then
   mvn clean deploy --settings deploy/settings.xml && exit 0; 
  fi
env:
  global:
  - secure: a5QVqmbbL1/RhdZn3cPuvQYgtgI1RCPKVpsbNMv6AWk/zo9m1NzoI9uGwnNrwrpvOH+uP1D5LWLL7USjAcCxFoM4yM0tuBiIhsOjYywzX8zDbL3JrZwzzXpBdLXlVO5saqbBagRaoOAzSJ3brVFx1g0D8TJ36j3fRVu5DyF9lQqxW3Zn7n88GD32NTg33j1vVV8gi5gLU9/ZpWZk6u6KfXdFIQtPyI/iXAXO+mLOZP54rYaVYf/wmpQUpcms7KKDSwDrQhanPG+n42yQZmB9EDN/zHiwJPyxWLL9oY29Y3AbWGpZQbMEnaK8a6x9gtQoN8pmyiFAb41zM/LGWg0QvvDZWDb+UuA+0VLzGQBpBOY05DrQvuapyjmDI9wlq0kpl4vdWgcOkXrykKzvHQdZsnA4wA1B9KfJ92x4Uk4fLu0WQmtekGySeTtyF1C5yHRL/yZ5IZaZxStsH+KPCHjUivNuDq+xBqDPujj3rbZqSXSfksczAUKyVG7jHOIOLRvtgQesh/BkXQ9Oh89VAGeJVRcejQ9nGmfq0ARR16a55QdrrkTu2dNnIFlwfLhmqqXQdkh0fZSWYsqw76CrkkCY/ENG8AaUMz2SHS6y/hT15dgjTidrtJsPPycriwlRfrTiIDPM9+w/wOybkAJfLA12cs4uAU52Fk/0CstrLi76dbg=
  - secure: uePfzHi4fNRXjDoE1rD+hyVq+FWRFmcnLfZSLTf/9oi6yVqZnQWQUZEehcW3d8irucaoV1c9Jf02j91O5IFntob545b4LeCpT8AQ8Agj8YUWq+ZSY9bUo/GKonakkTIobRtOmKvmhSDdJXMzNqbRXN9B+yiNoUSn5Aei5rEHyRy5oV+uO5yppd7ADk4S9HnUS80rS4fCjkTshd5wr7qjkqW3E/ivQcLZEq/EjkacUtzNtfGM9Z79RDhJQXGsV76jKS3FTzpU3hsmYfRDqZ4d9/CQbzisI3cBJTc6QxVo7VbZm0rvPJrrZUZ9NT2wvy8V1La67lCNsTJMzZXnvJEFsLodUPVv0FELZ2z6F3vCckZPoEiEWgeYWYDjLTaZtswCRyi8cvc2nXK8LGMo5qM2mw4nxS/TZwRdJcn7jlluTql00I64Tgv0r6V0qdIq/l617TkNEP+59WczOiwiqYxbML9nG3UiJwUZ0g+wz9qGQ3poMzjjKZahNwqtNLzz0BK3zpYVGCK+v+MNfEmaQlrXkcVTkhlyAO1F58Yk3O2nPZWw2k3u+yjDubhntoM06B4kYL8BkHafc9YIsgFHIiSq8/HbbmQLS7qGHWfkI9xUbiYM3bfm2DsUd4tn3SKY0EDmDSPp+bvbfYbiEHhf3HNuXJONWErq+oMtD/cUv82lWps=
notifications:
  slack:
    secure: J4GKn5vY7RmegqytRDM9Au3qFO6igMAYysZfc/OyDC+yYhz2XkVPVrbUAeLQ4fdX2SgOx5O/cmSVtvs0S8L9XtKTmJIYxVJjVTZgVmjHkImEwqKHWs6pdXPNMPzbsvFKv6QZtRHtVHvrg51vIGn5KLpWxTD6rhvH2hY8q9OO5TbUjbaXgQNqYYlwa0x6K8nTDscBSXb3kRzqqsNKKRfOUK+pb0LIzM0llP/FQbBqj3glWHRJCf7bWGi6zFqwIRg+AmG714E1aiKG7qorQWgAng9znTZ7SpobgiR6WOB7i2EqtnTAHUzrRS4kO/wxUpBCwWEpUwn+73f8axXSY7qYUPiJh18tOTyd5/2iYOe6FX3lX33Py3ePksYpNfmynFxPS1jzv6HghcTLsJ5DwlU4DewhLGeO1D2JY6uA6FmWeXF0BJAD/BEMhjIRb1f/kEv75f7tpyA+1jAzv2uQg+uiOZZKmkog0810WF8SmrS63xYY/bn137RYdYHwJA6wUxWnPnbzlwPQOF39U5t2tacJVJpxMbg4877zI4djeDWqTRFK2xzg24QVh4x17J8J+yr0OlnDkYU03yGkhRyi5t2ay1k3fS2xnMS/vjD509wkAnLFy5596vvu6sRlLP9s3QOZJWgagJbof/iJDk7W39kOWpg17eMPXZQISFEcAMj/eh8=
    on_success: change
    on_failure: always
